<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
    	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../../css/mui.min.css" />
		<link rel="stylesheet" href="../../../css/base.css" />
		<link rel="stylesheet" href="../../../css/main.css" />
		<link rel="stylesheet" href="http://at.alicdn.com/t/font_789951_jgy9npcg4pe.css" />
		<script type="text/javascript" src="../../../js/e_fish.js" ></script>
		<script type="text/javascript" src="../../../js/mui.min.js" ></script>
		<script type="text/javascript" src="../../../js/vue.js" ></script>
	</head>
	<style>
		
	</style>
	<body id="e_fish_container">
		<div id="app">
	        <div class="y_logo">
	            <img src="../../../images/y-logo.png" alt="">
	        </div> 
	        <div class="plr40 y_login_box">
	            <form>
	                <div class="y_method  ub ub-pac">
	                    <div class="ub-f1" :class="{'active' : index == 0}" @tap='change(0)'>注册</div>
	                    <div class="ub-f1" :class="{'active' : index == 1}" @tap='change(1)'>登录</div>
	                </div>
	                <!-- 注册 -->
	                <div class="y_input" v-if="index == 0">
	                    <!-- 验证码 -->
	                    <div class="y_code" v-if="nextTap">
	                    	<div class="mui-input-row y_input_item">
						    	<input type="text" class="mui-input-clear" placeholder="请输入手机号" v-model="tel">
						    </div> 
	                        <div class="y_input_item ub  ub-ac">
	                            <input type="text" placeholder="请输入验证码" class="ub-f1" v-model="code">
	                            <span class="y_getcode" @tap="getCode" v-if="!isSend">获取验证码</span>
	                            <span class="y_getcode" v-else>剩余{{timer}}秒</span>
	                        </div>
	                        <div class="y_input_item ub pr40 ub-ac">
	                            <input type="text" placeholder="注册邀请码（可不填）" class="ub-f1">
	                        </div>
	                        <button class="btn btn-green" type="button" @tap="nextstep">下一步</button>
	                    </div>
	                    <!-- 密码 --> 
	                    <div class="y_pwd" v-else>
	                    	<div class="mui-input-row y_input_item">
						    	<input type="password" class="mui-input-password" placeholder="请输入6-16位字母数字密码">
						    </div>
						    <div class="mui-input-row y_input_item">
						    	<input type="password" class="mui-input-password" placeholder="请再次输入密码">
						    </div>
	                        <div class="ub ub-ac y_agreement">
	                        	<div class="y_agree" :class="{'active':agree}" @tap="isAgree"></div>
	                        	<p>同意<a href="#">《用户使用协议）</a></p>
	                        </div>
	                        <button class="btn btn-green" :class="{'btn-none':!agree}" type="button">注册</button> 
	                    </div>
	                </div>
	                <!-- 登陆 -->
	                <div class="y_input" v-if="index == 1">
	                	<div class="y_login">
	                		<div class="mui-input-row y_input_item">
						    	<input type="text" class="mui-input-clear" placeholder="请输入手机号/身份证号" v-model="username">
						    </div>
						    <div class="mui-input-row y_input_item">
						    	<input type="password" class="mui-input-password" placeholder="请输入密码" v-model="userpwd">
						    </div>
	                        <span class="c-green fz32 y_codelogin" to="my/login/messageCode" title="登录">使用短信验证码登录</span>
	                        <button class="btn btn-green" type="button" @tap="login">登录</button>
	                        <div class="tx-c">
	                        	<a href="#" class="c-green fz32 y_codelogin">找回密码</a>
	                        </div> 
	                	</div>
	                </div>
	                
	            </form>
	        </div>
	    </div>
	</body>
	<script>
		var _oldBack = mui.back; 
		var backButtonPress = 0;
		mui.back = function(event) {                    
		    backButtonPress++;
		    if (backButtonPress > 1) {
		        plus.runtime.quit();
		    } else {
		        plus.nativeUI.toast('再按一次退出应用');
		    }
		    setTimeout(function() {
		        backButtonPress = 0;
		    }, 1000);
		    return false;
		};
		new Vue({
			el:'#app',
			data:{
				index : 0,
				nextTap : true,
				agree : false,
				username : '',
				userpwd : '',
				deviceid:'',
				tel :'',
				code :'',
				isSend : false,
				timer : 60
			},
			methods:{
				change(index){
					this.index = index
				},
				nextstep(){
					this.nextTap = false
					console.log(this.nextTap)
				},
				isAgree(){
					this.agree = !this.agree
				},
				login(){
					if(this.username == ''){
						mui.toast('请填写手机号或身份证');
						return;
					}
					if(this.userpwd == ''){
						mui.toast('请填写密码');
						return;
					}
					App.http('v1/publics.user/login', {
						account:this.username,
			            pwd:this.userpwd,
			            deviceid:this.deviceid
					},function(data) {
						if(data.status == 1){
							App.setItem('token', data.data.token);
							App.setItem('user',data.data.userinfo);
							upDevice();
							//更新数据 
							App.send('page/project/index.html', 'update');
							App.send('page/my/index.html', 'update');
							mui.toast('登陆成功');
							mui.currentWebview.close('slide-out-bottom',300);
						}
						mui.toast(data.msg);
//						return;

					});	
				},
				getCode(){
					var that = this;
					App.http('v1/publics.sms/sendRegSms', {
						phone:this.tel
					},function(data, status) {
						console.log(data)
			            mui.toast(data.msg, {duration: 'short', type: 'button'});
			            if(data.status==1){
			            	that.gettimer();
			            }
			            
					});	
				},
				gettimer:function(){
					
			        var that = this;
			        this.isSend = true;
			        var time=setInterval(function(){
			          	that.timer--;
			          	if(that.timer==0){
				            that.isSend=false;
				            that.timer=60;
				            clearInterval(time);
			          	}
			        },1000)
			    }
				
			},
			mounted:function(){
				mui.plusReady(function(){
//						获取设备信息
				    var info = plus.push.getClientInfo();
				    console.log(JSON.stringify(info))
					if(info.clientid == ''){
						mui.toast('没有获取到您的设备信息');
						return;
					}else{
						this.deviceid = info.clientid;
				   	}
					
				});
			}
		})
	</script>
</html>
